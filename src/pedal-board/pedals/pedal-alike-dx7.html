<link rel="import" href="./js/pedal-behavior.html">
<link rel="import" href="https://webaudiomodules.org/temp/wam-host.html">
<script>UseWebAudioControlsMidi=1</script>
<dom-module id="pedal-alike-dx7">
  <template>
    <style include="shared-styles">
      body {
        font-family: sans-serif ;
        font-weight: 100 ;
        font-size: 14px ;
        user-select: none ;
        cursor: default ;
        padding: 5px 0 0 10px ;
      }

      header {
        margin-bottom: 20px;
      }

      h1 {
        font-weight: 100;
        margin: 0;
        font-size: 20px;
      }

      #unsupported {
        margin-bottom: 30px;
      }

      #unsupported a {
        text-decoration: underline;
      }

      #content {
        width: 800px;
        background: #000;
        padding: 5px;
      }

      #topbar {
        display: flex;
        background: #222;
        color: #eee;
        height: 40px;
        line-height: 40px;
        padding-left: 10px;
        border-bottom: 5px solid darkgreen;
      }

      .right {
        display: flex;
        margin-left: auto;
      }

      .control {
        margin: 0 10px;
      }

      label {
        color: #bbb;
        font-size: 12px;
      }

      select {
        background: #222;
        color: #eee;
        height: 20px;
        margin-top: 10px;
        cursor: pointer;
      }

      li {
        cursor: pointer;
      }

      footer {
        width: 810px;
        display: flex;
        justify-content: flex-end;
        font-size: 12px;
        color: #444;
        margin-top: 5px;
      }

      a,
      a:visited {
        color: #000;
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
        color: darkgreen;
      }
    </style>
    <div class="laPedale">
      <div id="content">
        <wam-host id="dx7"></wam-host>  
      </div>
    </div>
  </template>
  <script>
    class PedalAlikeDx7 extends PBPlugin(Polymer.Element) {

      static get is() { return 'pedal-alike-dx7'; }

      static get properties() {
        return {
          dataWidth: {
            type: Number,
            value: 800
          },
          dataHeight: {
            type: Number,
            value: 120
          }
        };
      }

      ready() {
        super.ready();

        // inherited
        this.createAllInternNodes();
        this.resetKnobs();
        this.setKnobsListeners();
        this.setValuesToKnobs();

      }

      createAllInternNodes() {
        let actx, dx=this;

        if (AWPF.isAudioWorkletPolyfilled)
          actx = AWPF.context;
        else actx = GlobalContext.context;

        var host = this.$.dx7;

        host.context = actx;
        host.load("https://webaudiomodules.org/temp/synths/dx7.js").then( function (wam) {
           wam.connect(dx.soundNodeOut); // Jari: this.soundNoteOut is inherited too...
        });
      }
    }

    // Register the x-custom element with the browser
    customElements.define(PedalAlikeDx7.is, PedalAlikeDx7);
  </script>
</dom-module>