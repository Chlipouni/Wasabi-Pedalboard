<link rel="import" href="../../../bower_components/webaudio-controls/webaudio-controls.html">
<link rel="import" href="./js/pedal-behavior.html">


<dom-module id="pedal-reverb">
    <template>
      <style include="shared-styles">
         :host {
          /*background-color: #080808;*/
          background: linear-gradient(#c0d3d1, #8b8b8b);
        }
      </style>
  
      <div class="laPedale">
        <div class="elements">
  
          <div class="row">
            <div class="column">
                <webaudio-knob id="knob1" class="knob" midilearn="true" sprites="99" value="0" step="1" src="./img/knobs/nux_black_white_stripe.png" data-role="time" width="40" height="40"></webaudio-knob>
                <span class="knob-label" id="knob1-label">TIME</span>
            </div>
            <div class="column">
              <webaudio-knob id="knob2" class="knob" sprites="99" value="0" step="1" midilearn="true" src="./img/knobs/nux_yellow_not_stripped.png"
                width="40" height="40" data-role="decay"></webaudio-knob>
              <span class="knob-label" id="knob2-label">DECAY</span>
            </div>
          </div>
  
          <div class="row">
            <div class="column">
              <webaudio-knob id="knob3" class="knob" sprites="99" value="0" step="1" midilearn="true" src="./img/knobs/nux_yellow_not_stripped.png"
                width="40" height="40" data-role="mix"></webaudio-knob>
              <span class="knob-label" id="knob3-label">MIX</span>
            </div>
            <!--<div class="column">
              <webaudio-switch id="switch2" class="switch" midilearn="true" src="./img/switches/switch_1.png"
                width="40" height="25"></webaudio-switch>
              <span class="knob-label" id="knob3-label">reverse</span>
            </div>-->
          </div>
  
          <div class="row">
            <div class="column">
              <webaudio-switch id="switch1" class="switch" midilearn="true" src="./img/switches/switch_1.png" width="40" height="25"></webaudio-switch>
            </div>
          </div>
  
          <div class="row">
            <div class="column">
              <span class="pedalLabel">REVERB</span>
            </div>
          </div>
  
        </div>
      </div>
    </template>
    <script>
    class PedalReverb extends MyMixin(Polymer.Element) {
        static get is() {
          return 'pedal-reverb';
        }
        static get properties() {
          return {
            dataWidth: {
              type: Number,
              value: 100
            },
            dataHeight: {
              type: Number,
              value: 180
            }
          };
        }
        ready() {
        super.ready();
        this.createAllInternNodes();
        this.connectInternNodes();
        this.resetKnobs();
        this.setKnobsListeners();
        this.setValuesToKnobs();
        this.setPedalActive();
        this.setSwitchListener();
        }

        createAllInternNodes() {
        this.effect = new Pizzicato.Effects.Reverb();
      }
      connectInternNodes() {
        this.soundNodeIn.connect(this.effect);
        this.effect.connect(this.soundNodeOut);
      }
      setKnobsListeners() {
        this.$.knob1.addEventListener('change', (e) => this.effect.time = e.target.value / 100);
        this.$.knob2.addEventListener('change', (e) => this.effect.decay = e.target.value / 100);
        this.$.knob3.addEventListener('change', (e) => this.effect.mix = e.target.value / 100);

        //this.$.switch2.addEventListener('click',(e) => this.effect.reverse = !this.effect.reverse)
      }
      getDefaultButtonsValues() {
        return {
          time: 30,
          decay: 50,
          mix: 60
        };
      }
      bypass() {
        this.effect.bypass();
      }
      /* Ici on utilise la fonction getCurrentKnobsValues pour avoir une memoire des boutons en allumant et Ã©teignant*/
      reactivate() {
       var currentValues = this.getCurrentKnobsValues();
       this.effect.decay= currentValues.decay / 100;
       this.$.knob2.value = currentValues.decay;

       this.effect.time= currentValues.time / 100;
       this.$.knob1.value = currentValues.time;
       this.effect.mix= currentValues.mix / 100;
       this.$.knob3.value = currentValues.mix;
      }
    }
    // Register the x-custom element with the browser
    customElements.define(PedalReverb.is, PedalReverb);
    
    </script>
    


</dom-module>